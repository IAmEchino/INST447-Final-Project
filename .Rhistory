proj4string(merged_data) <- CRS("+proj=longlat +datum=WGS84") # Assign coordinate system
# 4. Define the Spatial Weights Matrix (W-Matrix)
# We use a k-nearest neighbors approach (k=4) to define neighborhood.
# This connects each ZIP code to its 4 closest neighbors.
k_neighbors <- knearneigh(merged_data, k=4)
nb_4 <- knn2nb(k_neighbors)
# Convert the neighbors list into a row-standardized weight matrix
# 'style="W"' means row-standardized weights (each row sums to 1).
listw_4 <- nb2listw(nb_4, style="W")
# 5. Define the Linear Model Formula
# Dependent variable: Zillow Median Price
# Independent variable: Airbnb Count
formula <- zillow_median_price ~ airbnb_count
# 6. Run the Spatial Error Model (SEM)
# The spdep::errorsarlm function estimates the SEM.
# The type="error" argument specifies the Spatial Error Model.
spatial_error_model <- spdep::errorsarlm(
formula,
data = merged_data,
listw = listw_4,
type = "error"
)
install.packages("spatialreg")
# 1. Install and Load Necessary Libraries
# IMPORTANT: You must install 'spatialreg'
# install.packages(c("spdep", "sp", "RANN", "spatialreg")) # <-- UNCOMMENT AND RUN THIS LINE FIRST
library(spdep)
library(sp)
library(RANN)
library(spatialreg) # <-- NOW CONTAINS errorsarlm
# 2. Load the Data
merged_data <- read.csv("merged.csv")
# 3. Create a Spatial Data Frame
# Spatial models require coordinate data. We use the averaged Airbnb coordinates.
# First, remove any rows with missing coordinates, if necessary.
merged_data <- na.omit(merged_data, cols = c("airbnb_avg_longitude", "airbnb_avg_latitude"))
coordinates(merged_data) <- ~airbnb_avg_longitude + airbnb_avg_latitude
proj4string(merged_data) <- CRS("+proj=longlat +datum=WGS84") # Assign coordinate system
# 4. Define the Spatial Weights Matrix (W-Matrix)
# We use a k-nearest neighbors approach (k=4) to define neighborhood.
# This connects each ZIP code to its 4 closest neighbors.
k_neighbors <- knearneigh(merged_data, k=4)
nb_4 <- knn2nb(k_neighbors)
# Convert the neighbors list into a row-standardized weight matrix
# 'style="W"' means row-standardized weights (each row sums to 1).
listw_4 <- nb2listw(nb_4, style="W")
# 5. Define the Linear Model Formula
# Dependent variable: Zillow Median Price
# Independent variable: Airbnb Count
formula <- zillow_median_price ~ airbnb_count
# 6. Run the Spatial Error Model (SEM)
# The spdep::errorsarlm function estimates the SEM.
# The type="error" argument specifies the Spatial Error Model.
spatial_error_model <- spdep::errorsarlm(
formula,
data = merged_data,
listw = listw_4,
type = "error"
)
# 1. Install and Load Necessary Libraries
# IMPORTANT: You must install 'spatialreg'
# install.packages(c("spdep", "sp", "RANN", "spatialreg")) # <-- UNCOMMENT AND RUN THIS LINE FIRST
library(spdep)
library(sp)
library(RANN)
library(spatialreg) # <-- NOW CONTAINS errorsarlm
# 2. Load the Data
merged_data <- read.csv("merged.csv")
# 3. Create a Spatial Data Frame
# Spatial models require coordinate data. We use the averaged Airbnb coordinates.
# First, remove any rows with missing coordinates, if necessary.
merged_data <- na.omit(merged_data, cols = c("airbnb_avg_longitude", "airbnb_avg_latitude"))
coordinates(merged_data) <- ~airbnb_avg_longitude + airbnb_avg_latitude
proj4string(merged_data) <- CRS("+proj=longlat +datum=WGS84") # Assign coordinate system
# 4. Define the Spatial Weights Matrix (W-Matrix)
# We use a k-nearest neighbors approach (k=4) to define neighborhood.
# This connects each ZIP code to its 4 closest neighbors.
k_neighbors <- knearneigh(merged_data, k=4)
nb_4 <- knn2nb(k_neighbors)
# Convert the neighbors list into a row-standardized weight matrix
# 'style="W"' means row-standardized weights (each row sums to 1).
listw_4 <- nb2listw(nb_4, style="W")
# 5. Define the Linear Model Formula
# Dependent variable: Zillow Median Price
# Independent variable: Airbnb Count
formula <- zillow_median_price ~ airbnb_count
# 6. Run the Spatial Error Model (SEM)
# The spdep::errorsarlm function estimates the SEM.
# The type="error" argument specifies the Spatial Error Model.
spatial_error_model <- spatialreg::errorsarlm(
formula,
data = merged_data,
listw = listw_4,
type = "error"
)
# R Code for Spatial Error Model (SEM) - CORRECTED
# 1. Load Necessary Libraries
library(spdep)
library(sp)
library(RANN)
library(spatialreg)
# 2. Load the Data
merged_data <- read.csv("merged.csv")
# 3. Create a Spatial Data Frame
# Remove any rows with missing coordinates
merged_data <- na.omit(merged_data)
coordinates(merged_data) <- ~airbnb_avg_longitude + airbnb_avg_latitude
proj4string(merged_data) <- CRS("+proj=longlat +datum=WGS84")
# 4. Define the Spatial Weights Matrix (W-Matrix)
# Using k-nearest neighbors (k=4)
k_neighbors <- knearneigh(merged_data, k=4)
nb_4 <- knn2nb(k_neighbors)
# Convert to a row-standardized weight matrix
listw_4 <- nb2listw(nb_4, style="W")
# 5. Define the Linear Model Formula
formula <- zillow_median_price ~ airbnb_count
# 6. Run the Spatial Error Model (SEM)
# The function call is simplified, removing the 'type' argument.
spatial_error_model <- spatialreg::errorsarlm(
formula,
data = merged_data,
listw = listw_4
)
# 7. Print the Summary
summary(spatial_error_model)
# R Code for Visualization: Map of Residuals
library(ggplot2)
install.packages("ggplot2")
install.packages("sf")
# R Code for Visualization: Map of Residuals
library(ggplot2)
library(sf)
# 1. Convert the 'sp' object to an 'sf' object for ggplot visualization
merged_sf <- st_as_sf(merged_data)
# 2. Add Residuals and Fitted Values (if not done in step A)
if (!("sem_residuals" %in% names(merged_sf))) {
merged_sf$sem_residuals <- residuals(spatial_error_model)
}
# Create a bubble map where size and color represent the residual value.
png("sem_residuals_map.png", width=700, height=500)
residuals_plot <- ggplot(merged_sf) +
# Use geom_sf for mapping the spatial points
geom_sf(aes(size = abs(sem_residuals), color = sem_residuals)) +
scale_color_gradient2(
low = "red",       # Over-predicted (negative residual)
mid = "gray90",
high = "blue",     # Under-predicted (positive residual)
midpoint = 0,
name = "Residuals (USD)"
) +
scale_size(range = c(1, 10), name = "Abs. Residuals") +
labs(
title = "Spatial Error Model Residuals: DC ZIP Codes",
subtitle = "Color/Size indicates the model's prediction error (Actual - Fitted Price)"
) +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5))
print(residuals_plot)
# Load the data
merged_data <- read.csv("merged.csv")
# Fit the linear model to calculate R-squared and residuals
model <- lm(zillow_median_price ~ airbnb_count, data = merged_data)
r_squared_text <- paste0("R^2 = ", format(summary(model)$r.squared, digits = 3))
# R Code for Visualization: Map of Residuals
library(ggplot2)
library(sf)
# 1. Convert the 'sp' object to an 'sf' object for ggplot visualization
merged_sf <- st_as_sf(merged_data)
# ===============================================================
# 2. Residuals Plot
# ===============================================================
# png("airbnb_housing_residuals.png", width=600, height=500)
plot(
fitted(model),
resid(model),
main = "Residuals Plot of Housing Price vs. Airbnb Count",
xlab = "Fitted Zillow Median Price (USD)",
ylab = "Residuals (Actual - Fitted Price)",
pch = 19,
col = "darkgreen"
)
# Add a horizontal line at 0
abline(h = 0, col = "red", lty = 2)
# R Code for Spatial Error Model (SEM) - CORRECTED
# 1. Load Necessary Libraries
library(spdep)
library(sp)
library(RANN)
library(spatialreg)
# 2. Load the Data
merged_data <- read.csv("merged.csv")
# 3. Create a Spatial Data Frame
# Remove any rows with missing coordinates
merged_data <- na.omit(merged_data)
coordinates(merged_data) <- ~airbnb_avg_longitude + airbnb_avg_latitude
proj4string(merged_data) <- CRS("+proj=longlat +datum=WGS84")
# 4. Define the Spatial Weights Matrix (W-Matrix)
# Using k-nearest neighbors (k=4)
k_neighbors <- knearneigh(merged_data, k=4)
nb_4 <- knn2nb(k_neighbors)
# Convert to a row-standardized weight matrix
listw_4 <- nb2listw(nb_4, style="W")
# 5. Define the Linear Model Formula
formula <- zillow_median_price ~ airbnb_count
# 6. Run the Spatial Error Model (SEM)
# The function call is simplified, removing the 'type' argument.
spatial_error_model <- spatialreg::errorsarlm(
formula,
data = merged_data,
listw = listw_4
)
# 7. Print the Summary
summary(spatial_error_model)
# R Code for Visualization: Map of Residuals
library(ggplot2)
library(sf)
# 1. Convert the 'sp' object to an 'sf' object for ggplot visualization
merged_sf <- st_as_sf(merged_data)
# 2. Add Residuals and Fitted Values (if not done in step A)
if (!("sem_residuals" %in% names(merged_sf))) {
merged_sf$sem_residuals <- residuals(spatial_error_model)
}
# Create a bubble map where size and color represent the residual value.
png("sem_residuals_map.png", width=700, height=500)
residuals_plot <- ggplot(merged_sf) +
# Use geom_sf for mapping the spatial points
geom_sf(aes(size = abs(sem_residuals), color = sem_residuals)) +
scale_color_gradient2(
low = "red",       # Over-predicted (negative residual)
mid = "gray90",
high = "blue",     # Under-predicted (positive residual)
midpoint = 0,
name = "Residuals (USD)"
) +
scale_size(range = c(1, 10), name = "Abs. Residuals") +
labs(
title = "Spatial Error Model Residuals: DC ZIP Codes",
subtitle = "Color/Size indicates the model's prediction error (Actual - Fitted Price)"
) +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5))
print(residuals_plot)
dev.off()
print(residuals_plot)
print(residuals_plot)
# Create a bubble map where size and color represent the residual value.
png("sem_residuals_map.png", width=1000, height=1000)
residuals_plot <- ggplot(merged_sf) +
# Use geom_sf for mapping the spatial points
geom_sf(aes(size = abs(sem_residuals), color = sem_residuals)) +
scale_color_gradient2(
low = "red",       # Over-predicted (negative residual)
mid = "gray90",
high = "blue",     # Under-predicted (positive residual)
midpoint = 0,
name = "Residuals (USD)"
) +
scale_size(range = c(1, 10), name = "Abs. Residuals") +
labs(
title = "Spatial Error Model Residuals: DC ZIP Codes",
subtitle = "Color/Size indicates the model's prediction error (Actual - Fitted Price)"
) +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5))
print(residuals_plot)
print(residuals_plot)
# Create a bubble map where size and color represent the residual value.
png("sem_residuals_map.png", width=1000, height=1000)
residuals_plot <- ggplot(merged_sf) +
# Use geom_sf for mapping the spatial points
geom_sf(aes(size = abs(sem_residuals), color = sem_residuals)) +
scale_color_gradient2(
low = "red",       # Over-predicted (negative residual)
mid = "gray90",
high = "blue",     # Under-predicted (positive residual)
midpoint = 0,
name = "Residuals (USD)"
) +
scale_size(range = c(1, 10), name = "Abs. Residuals") +
labs(
title = "Spatial Error Model Residuals: DC ZIP Codes",
subtitle = "Color/Size indicates the model's prediction error (Actual - Fitted Price)"
) +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5))
print(residuals_plot)
dev.off()
# Create a bubble map where size and color represent the residual value.
png("sem_residuals_map.png", width=1000, height=1000)
residuals_plot <- ggplot(merged_sf) +
# Use geom_sf for mapping the spatial points
geom_sf(aes(size = abs(sem_residuals), color = sem_residuals)) +
scale_color_gradient2(
low = "red",       # Over-predicted (negative residual)
mid = "black",
high = "blue",     # Under-predicted (positive residual)
midpoint = 0,
name = "Residuals (USD)"
) +
scale_size(range = c(1, 10), name = "Abs. Residuals") +
labs(
title = "Spatial Error Model Residuals: DC ZIP Codes",
subtitle = "Color/Size indicates the model's prediction error (Actual - Fitted Price)"
) +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5))
print(residuals_plot)
dev.off()
# Create a bubble map where size and color represent the residual value.
png("sem_residuals_map.png", width=1000, height=1000)
residuals_plot <- ggplot(merged_sf) +
# Use geom_sf for mapping the spatial points
geom_sf(aes(size = abs(sem_residuals), color = sem_residuals)) +
scale_color_gradient2(
low = "red",       # Over-predicted (negative residual)
mid = "yellow",
high = "blue",     # Under-predicted (positive residual)
midpoint = 0,
name = "Residuals (USD)"
) +
scale_size(range = c(1, 10), name = "Abs. Residuals") +
labs(
title = "Spatial Error Model Residuals: DC ZIP Codes",
subtitle = "Color/Size indicates the model's prediction error (Actual - Fitted Price)"
) +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5))
print(residuals_plot)
dev.off()
# Create a bubble map where size and color represent the residual value.
png("sem_residuals_map.png", width=1000, height=1000)
residuals_plot <- ggplot(merged_sf) +
# Use geom_sf for mapping the spatial points
geom_sf(aes(size = abs(sem_residuals), color = sem_residuals)) +
scale_color_gradient2(
low = "red",       # Over-predicted (negative residual)
mid = "gray95",
high = "blue",     # Under-predicted (positive residual)
midpoint = 0,
name = "Residuals (USD)"
) +
scale_size(range = c(1, 10), name = "Abs. Residuals") +
labs(
title = "Spatial Error Model Residuals: DC ZIP Codes",
subtitle = "Color/Size indicates the model's prediction error (Actual - Fitted Price)"
) +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5))
print(residuals_plot)
dev.off()
png("sem_residuals_map.png", width=1000, height=1000)
residuals_plot <- ggplot(merged_sf) +
# Use geom_sf for mapping the spatial points
geom_sf(aes(size = abs(sem_residuals), color = sem_residuals)) +
scale_color_gradient2(
low = "red",       # Over-predicted (negative residual)
mid = "gray50",
high = "blue",     # Under-predicted (positive residual)
midpoint = 0,
name = "Residuals (USD)"
) +
scale_size(range = c(1, 10), name = "Abs. Residuals") +
labs(
title = "Spatial Error Model Residuals: DC ZIP Codes",
subtitle = "Color/Size indicates the model's prediction error (Actual - Fitted Price)"
) +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5))
print(residuals_plot)
dev.off()
# Create a bubble map where size and color represent the residual value.
png("sem_residuals_map.png", width=1000, height=1000)
residuals_plot <- ggplot(merged_sf) +
# Use geom_sf for mapping the spatial points
geom_sf(aes(size = abs(sem_residuals), color = sem_residuals)) +
scale_color_gradient2(
low = "red",       # Over-predicted (negative residual)
mid = "gray90",
high = "blue",     # Under-predicted (positive residual)
midpoint = 0,
name = "Residuals (USD)"
) +
scale_size(range = c(1, 10), name = "Abs. Residuals") +
labs(
title = "Spatial Error Model Residuals: DC ZIP Codes",
subtitle = "Color/Size indicates the model's prediction error (Actual - Fitted Price)"
) +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5))
print(residuals_plot)
dev.off()
# Create a bubble map where size and color represent the residual value.
png("sem_residuals_map.png", width=1000, height=1000)
residuals_plot <- ggplot(merged_sf) +
# Use geom_sf for mapping the spatial points
geom_sf(aes(size = abs(sem_residuals), color = sem_residuals)) +
scale_color_gradient2(
low = "red",       # Over-predicted (negative residual)
mid = "gray90",
high = "blue",     # Under-predicted (positive residual)
midpoint = 0,
name = "Residuals (USD)"
) +
scale_size(range = c(1, 50), name = "Abs. Residuals") +
labs(
title = "Spatial Error Model Residuals: DC ZIP Codes",
subtitle = "Color/Size indicates the model's prediction error (Actual - Fitted Price)"
) +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5))
print(residuals_plot)
dev.off()
png("sem_residuals_map.png", width=1000, height=1000)
residuals_plot <- ggplot(merged_sf) +
# Use geom_sf for mapping the spatial points
geom_sf(aes(size = abs(sem_residuals), color = sem_residuals)) +
scale_color_gradient2(
low = "red",       # Over-predicted (negative residual)
mid = "gray90",
high = "blue",     # Under-predicted (positive residual)
midpoint = 0,
name = "Residuals (USD)"
) +
scale_size(range = c(1, 30), name = "Abs. Residuals") +
labs(
title = "Spatial Error Model Residuals: DC ZIP Codes",
subtitle = "Color/Size indicates the model's prediction error (Actual - Fitted Price)"
) +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5))
print(residuals_plot)
dev.off()
merged_data <- read.csv("merged.csv")
View(merged_data)
zillow_data <- read.csv("zillow.csv")
View(zillow_data)
plot(merged_data$airbnb_median_price, merged_data$zillow_median_price)
plot(
merged_data$airbnb_count,
merged_data$zillow_median_price,
main = "Airbnb Density vs Housing Cost",
xlab = "Airbnb Count (Listings per ZIP Code)",
ylab = "Zillow Listing Price (Median Price per ZIP Code)",
pch = 19,
col = "blue"
)
model <- lm(zillow_median_price ~ airbnb_count, data = merged_data)
abline(model, col = "red", lwd = 2)
merged_data <- read.csv("merged.csv")
View(merged_data)
zillow_data <- read.csv("zillow.csv")
View(zillow_data)
plot(merged_data$airbnb_median_price, merged_data$zillow_median_price)
plot(
merged_data$airbnb_count,
merged_data$zillow_median_price,
main = "Airbnb Density vs Housing Cost",
xlab = "Airbnb Count (Listings per ZIP Code)",
ylab = "Zillow Listing Price (Median Price per ZIP Code)",
pch = 19,
col = "blue"
)
model <- lm(zillow_median_price ~ airbnb_count, data = merged_data)
abline(model, col = "red", lwd = 2)
plot(
merged_data$airbnb_count,
merged_data$zillow_median_price,
main = "Airbnb Density vs Housing Cost",
xlab = "Airbnb Count (Listings per ZIP Code)",
ylab = "Zillow Listing Price (Median Price per ZIP Code)",
pch = 19,
col = "blue"
)
model <- lm(zillow_median_price ~ airbnb_count, data = merged_data)
abline(model, col = "red", lwd = 2)
languageserversetup::languageserver_install()
languageserversetup::languageserver_add_to_rprofile()
library(ggplot2)
merged_data <- read.csv("merged.csv")
histogram <- ggplot(merged_data, aes(x = population)) +
geom_histogram(
bins = 10,
fill = "skyblue",
color = "black",
alpha = 0.8
) +
labs(
title = "Distribution of Population Across ZIP Codes",
x = "Population (ZIP Code)",
y = "Number of ZIP Codes"
) +
theme_minimal(base_size = 12)
ggsave(
filename = "Question 2 Histogram.png",
plot = histogram,
width = 8,
height = 6,
units = "in"
)
# Buckets appear to show this trend: 0-20,000 is 8 ZIP codes; 20k-40k is 7 zips;
# and 40k-80k is 6 zip codes
